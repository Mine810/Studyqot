<!DOCTYPE html>
<html lang="ur" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Urdu Grammar Quiz - Bihar Board Class 10</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Noto Nastaliq Urdu -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Nastaliq+Urdu:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        /* --- Base & Background --- */
        body {
            font-family: 'Noto Nastaliq Urdu', sans-serif;
            background-color: #050610; /* Starlight Dark */
            color: #e5e7eb; /* gray-200 */
        }

        .main-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        /* --- Glassmorphism Card --- */
        .glass-card {
            background: rgba(15, 23, 42, 0.6); /* slate-900 */
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(34, 211, 238, 0.2); /* cyan-400 */
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        /* --- Screen Transitions --- */
        .screen { display: none; animation: fadeIn 0.5s ease-out forwards; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px) scale(0.99); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        .active-screen { display: block; }
        
        /* --- Custom Scrollbar --- */
        .custom-scroll::-webkit-scrollbar { width: 8px; }
        .custom-scroll::-webkit-scrollbar-track { background: rgba(15, 23, 42, 0.5); }
        .custom-scroll::-webkit-scrollbar-thumb { background: #22d3ee; border-radius: 10px; }
        .custom-scroll::-webkit-scrollbar-thumb:hover { background: #67e8f9; }

        /* --- Custom Button Styles --- */
        .btn { transition: all 0.3s ease; }
        .btn-primary {
            background-image: linear-gradient(to right, #22d3ee, #06b6d4);
            color: #050610;
            font-weight: 700;
            box-shadow: 0 4px 15px 0 rgba(34, 211, 238, 0.2);
        }
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px 0 rgba(34, 211, 238, 0.3);
        }
        .btn-primary:disabled {
            background-image: none;
            background-color: #334155; /* slate-700 */
            color: #94a3b8; /* slate-400 */
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary { background-color: #334155; color: #d1d5db; }
        .btn-secondary:hover { background-color: #475569; }

        .btn-option {
            background-color: rgba(30, 41, 59, 0.5);
            border: 1px solid #334155;
            color: #cbd5e1;
        }
        .btn-option:hover:not(:disabled) {
            background-color: rgba(51, 65, 85, 0.7);
            border-color: #22d3ee;
            color: #fff;
        }
        .btn-option.selected {
            background-color: #06b6d4;
            color: #fff;
            font-weight: 700;
            border-color: #67e8f9;
            transform: scale(1.02);
        }
        
        /* --- Modal Styles --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(5px);
            display: flex; align-items: center; justify-content: center;
            z-index: 50; opacity: 0; visibility: hidden; transition: all 0.3s ease;
        }
        .modal-overlay.visible { opacity: 1; visibility: visible; }
        .modal-content { transform: scale(0.95); transition: all 0.3s ease; }
        .modal-overlay.visible .modal-content { transform: scale(1); }

        /* --- Progress Bar --- */
        .progress-bar-container { background-color: #1e293b; }
        .progress-bar { background-color: #22d3ee; transition: width 0.4s ease-out; }
        
        /* --- Spinner --- */
        .spinner {
            width: 24px; height: 24px;
            border: 3px solid rgba(34, 211, 238, 0.3); border-top-color: #22d3ee;
            border-radius: 50%; animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* --- Glowing Text --- */
        .text-glow {
            text-shadow: 0 0 5px rgba(34, 211, 238, 0.4), 0 0 10px rgba(34, 211, 238, 0.2);
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div id="app-container" class="w-full max-w-2xl mx-auto glass-card rounded-2xl p-6 sm:p-8">

            <!-- Screen 1: Chapter Selection -->
            <div id="chapterScreen" class="screen active-screen">
                <h1 class="text-3xl sm:text-4xl font-bold text-center text-cyan-300 text-glow mb-2">بہار بورڈ اردو کوئز</h1>
                <p class="text-center text-slate-400 mb-8 text-lg">امتحان 2026 کی تیاری کے لیے</p>
                
                <div class="border-t border-slate-700 pt-6">
                    <h2 class="text-2xl font-bold text-center mb-6 text-slate-200">کوئز کا موضوع منتخب کریں</h2>
                    <div class="space-y-4 text-lg max-h-60 custom-scroll pr-2 overflow-y-auto">
                        <div class="bg-slate-900/50 p-4 rounded-lg sticky top-0 z-10">
                            <label for="selectAll" class="flex items-center space-x-3 rtl:space-x-reverse cursor-pointer">
                                <input type="checkbox" id="selectAll" class="form-checkbox h-5 w-5 text-cyan-400 bg-slate-700 border-slate-600 rounded focus:ring-cyan-500">
                                <span class="font-bold text-slate-200">سب کو منتخب کریں</span>
                            </label>
                        </div>
                        <div id="chapterList" class="space-y-3 pl-4 border-r-2 border-cyan-500 pr-4"></div>
                    </div>
                    <button id="continueBtn" disabled class="w-full mt-8 btn btn-primary py-3 px-4 rounded-lg text-xl">
                        آگے بڑھیں
                    </button>
                </div>
            </div>

            <!-- Screen 2: User Name Input -->
            <div id="nameScreen" class="screen">
                <h1 class="text-3xl font-bold text-center text-cyan-300 text-glow mb-8">اپنا نام درج کریں</h1>
                <input type="text" id="userName" class="w-full bg-slate-800/70 border border-slate-600 text-white text-xl rounded-lg focus:ring-cyan-500 focus:border-cyan-500 block p-4 text-center" placeholder="یہاں لکھیں...">
                <button id="startQuizBtn" class="w-full mt-6 btn btn-primary py-3 px-4 rounded-lg text-xl">
                    کوئز شروع کریں
                </button>
            </div>

            <!-- Screen 3: The Quiz Interface -->
            <div id="quizScreen" class="screen">
                <div class="mb-4">
                    <div class="flex justify-between items-center mb-2 text-slate-400">
                        <div id="questionCounter"></div>
                        <div id="timer" class="font-bold">00:00</div>
                    </div>
                    <div class="w-full progress-bar-container rounded-full h-2.5">
                        <div id="progressBar" class="progress-bar h-2.5 rounded-full" style="width: 0%"></div>
                    </div>
                </div>
                <div class="bg-slate-800/50 p-6 rounded-lg my-6 min-h-[140px] flex items-center justify-center">
                    <p id="questionText" class="text-2xl text-center font-semibold leading-relaxed text-slate-100"></p>
                </div>
                <div id="optionsContainer" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                <button id="nextBtn" class="w-full mt-8 btn btn-primary py-3 px-4 rounded-lg text-xl" style="display: none;">
                    اگلا سوال
                </button>
            </div>

            <!-- Screen 4: Results Page -->
            <div id="resultScreen" class="screen">
                <h1 class="text-4xl font-bold text-center text-green-400 text-glow mb-4">نتائج</h1>
                <div class="glass-card p-6 rounded-lg text-center mb-6 border-slate-700">
                    <p class="text-xl mb-2 text-slate-300">نام: <span id="resultName" class="font-bold text-cyan-400"></span></p>
                    <p class="text-3xl mb-2 text-slate-300">آپ کا اسکور: <span id="resultScore" class="font-bold text-green-400">0</span></p>
                    <p class="text-xl text-slate-300">لیا گیا وقت: <span id="resultTime" class="font-bold text-cyan-400"></span></p>
                </div>
                 <div id="telegramStatus" class="flex items-center justify-center gap-3 text-center text-yellow-400 my-4 text-lg"></div>
                <h2 class="text-2xl font-bold text-center my-4 text-slate-200">جوابات کا جائزہ</h2>
                <div id="answerReview" class="custom-scroll max-h-80 overflow-y-auto space-y-6 p-4 bg-slate-800/50 rounded-lg"></div>
                 <button id="restartBtn" class="w-full mt-8 btn btn-primary py-3 px-4 rounded-lg text-xl">
                    دوبارہ شروع کریں
                </button>
            </div>
        </div>
    </div>

    <!-- Restart Confirmation Modal -->
    <div id="restartModal" class="modal-overlay">
        <div class="modal-content glass-card rounded-lg p-8 max-w-sm w-full text-center">
            <h3 class="text-2xl font-bold text-slate-200 mb-4">کیا آپ کو یقین ہے؟</h3>
            <p class="text-slate-400 mb-8">آپ کی موجودہ پیشرفت ختم ہو جائے گی۔</p>
            <div class="flex justify-center gap-4">
                <button id="confirmRestartBtn" class="btn btn-primary px-8 py-2 rounded-lg">ہاں</button>
                <button id="cancelRestartBtn" class="btn btn-secondary px-8 py-2 rounded-lg">نہیں</button>
            </div>
        </div>
    </div>

    <script>
        // --- QUIZ DATA ---
        const quizData = {
            "اردو قواعد": [
                { q: "'وہ لڑکی کتاب پڑھ رہی ہے' میں فعل کون سا ہے؟", o: ["کتاب", "لڑکی", "پڑھ رہی ہے", "وہ"], a: 2 },
                { q: "'ہم اسکول جا رہے ہیں' میں ضمیر کیا ہے؟", o: ["اسکول", "ہم", "جا", "رہے"], a: 1 },
                { q: "اسم کی کتنی قسمیں ہوتی ہیں؟", o: ["دو", "چار", "پانچ", "تین"], a: 3 },
                { q: "'حسین' کس قسم کا اسم ہے؟", o: ["اسم معرفہ", "اسم نکرہ", "اسم صفت", "اسم فاعل"], a: 2 },
                { q: "'میں نے کام کیا' میں فعل کی قسم ہے؟", o: ["لازم", "متعدی", "امر", "نہی"], a: 1 },
                { q: "'وہ' کس قسم کا ضمیر ہے؟", o: ["شخصی", "اشاریہ", "استفہامی", "موصولی"], a: 0 },
                { q: "'کتاب' کس قسم کا اسم ہے؟", o: ["اسم معرفہ", "اسم نکرہ", "اسم ضمیر", "اسم اشارہ"], a: 1 },
                { q: "'نے' کون سا حرف ہے؟", o: ["حرف ربط", "حرف شرط", "حرف اضافت", "حرف جار"], a: 3 },
                { q: "واحد کی جمع کیا کہلاتی ہے؟", o: ["فعل", "ضمیر", "صفت", "جمع"], a: 3 },
                { q: "'علی پڑھ رہا ہے' میں زمانہ کون سا ہے؟", o: ["ماضی", "حال", "مستقبل", "امر"], a: 1 },
                { q: "'گھر' کس قسم کا اسم ہے؟", o: ["علم", "ضمیر", "نکرہ", "صفت"], a: 2 },
                { q: "'تم' کس قسم کا ضمیر ہے؟", o: ["موصولی", "شخصی", "اشاریہ", "استفہامی"], a: 1 },
                { q: "'اگر' کون سا حرف ہے؟", o: ["حرف ربط", "حرف شرط", "حرف نفی", "حرف تعجب"], a: 1 },
                { q: "'باغ' کی جمع کیا ہے؟", o: ["باغوں", "باغا", "باغیں", "باغی"], a: 0 },
                { q: "'یہ' کس قسم کا اسم ہے؟", o: ["اسم اشارہ", "اسم صفت", "اسم فاعل", "اسم مفعول"], a: 0 },
                { q: "'خوبصورتی' میں کون سی صفت ہے؟", o: ["عدد", "مقداری", "کیفیت", "ذات"], a: 2 },
                { q: "'آپ' کا واحد کیا ہے؟", o: ["تو", "وہ", "تم", "توں"], a: 3 },
                { q: "'میٹھا' کس قسم کی صفت ہے؟", o: ["کیفیت", "عدد", "نسبتی", "اسم"], a: 0 },
                { q: "'نہیں' کون سا حرف ہے؟", o: ["حرف ربط", "حرف نفی", "حرف تعجب", "حرف سوال"], a: 1 },
                { q: "'کتنے' کس قسم کا لفظ ہے؟", o: ["عدد", "استفہامی", "اشاریہ", "نسبتی"], a: 1 },
                { q: "'کرنا' کس قسم کا فعل ہے؟", o: ["لازم", "متعدی", "امر", "ماضی"], a: 1 },
                { q: "'لکھ رہا تھا' کس زمانے کا فعل ہے؟", o: ["حال", "مستقبل", "ماضی", "امر"], a: 2 },
                { q: "'شخصی ضمیر' کی مثال ہے؟", o: ["یہ", "میں", "جو", "کہاں"], a: 1 },
                { q: "'پڑھنا' فعل کی کون سی قسم ہے؟", o: ["سادہ", "مرکب", "لازم", "معاون"], a: 0 },
                { q: "'تم' کا صیغہ کون سا ہے؟", o: ["واحد متکلم", "جمع غائب", "واحد حاضر", "جمع متکلم"], a: 2 },
                { q: "'جلدی' کون سی قسم کا لفظ ہے؟", o: ["اسم", "صفت", "حال", "حرف"], a: 2 },
                { q: "'جو' کس قسم کا ضمیر ہے؟", o: ["موصولی", "استفہامی", "اشاریہ", "شرطیہ"], a: 0 },
                { q: "'کتنا' کون سا لفظ ہے؟", o: ["عدد", "ضمیر", "حرف", "صفت"], a: 3 },
                { q: "'کے' کون سا حرف ہے؟", o: ["ربط", "جار", "اضافت", "شرط"], a: 2 },
                { q: "'دوڑ رہا ہے' میں فعل کون سا ہے؟", o: ["ہے", "رہا", "دوڑ رہا ہے", "دوڑ"], a: 2 }
            ]
        };

        // --- DOM ELEMENTS ---
        const screens = document.querySelectorAll('.screen');
        const chapterList = document.getElementById('chapterList');
        const selectAllCheckbox = document.getElementById('selectAll');
        const continueBtn = document.getElementById('continueBtn');
        const userNameInput = document.getElementById('userName');
        const startQuizBtn = document.getElementById('startQuizBtn');
        const questionCounter = document.getElementById('questionCounter');
        const timerEl = document.getElementById('timer');
        const progressBar = document.getElementById('progressBar');
        const questionText = document.getElementById('questionText');
        const optionsContainer = document.getElementById('optionsContainer');
        const nextBtn = document.getElementById('nextBtn');
        const resultName = document.getElementById('resultName');
        const resultScoreEl = document.getElementById('resultScore');
        const resultTime = document.getElementById('resultTime');
        const telegramStatus = document.getElementById('telegramStatus');
        const answerReview = document.getElementById('answerReview');
        const restartBtn = document.getElementById('restartBtn');
        const restartModal = document.getElementById('restartModal');
        const confirmRestartBtn = document.getElementById('confirmRestartBtn');
        const cancelRestartBtn = document.getElementById('cancelRestartBtn');

        // --- APP STATE ---
        let currentQuestions = [];
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let timerInterval;
        let seconds = 0;

        // --- TELEGRAM API DETAILS ---
        const BOT_TOKEN = '7824715442:AAEeBcDZhfZw1zZx4Q5fyIvpriXX-_C6pIE';
        const CHAT_ID = '7562968631';

        // --- FUNCTIONS ---

        function showScreen(screenId) {
            screens.forEach(screen => screen.classList.remove('active-screen'));
            document.getElementById(screenId).classList.add('active-screen');
        }

        function populateChapters() {
            if (!quizData || Object.keys(quizData).length === 0) {
                chapterList.innerHTML = `<p class="text-slate-400 text-center">کوئی کوئز دستیاب نہیں۔</p>`;
                continueBtn.disabled = true;
                selectAllCheckbox.disabled = true;
                return;
            }
            Object.keys(quizData).forEach(chapter => {
                const div = document.createElement('div');
                div.innerHTML = `
                    <label class="flex items-center space-x-3 rtl:space-x-reverse cursor-pointer text-slate-300">
                        <input type="checkbox" name="chapter" value="${chapter}" class="chapter-checkbox form-checkbox h-5 w-5 text-cyan-400 bg-slate-700 border-slate-600 rounded focus:ring-cyan-500">
                        <span>${chapter}</span>
                    </label>
                `;
                chapterList.appendChild(div);
            });
        }

        function startQuiz() {
            const userName = userNameInput.value.trim() || 'گمنام';
            const selectedChapters = [...document.querySelectorAll('.chapter-checkbox:checked')].map(c => c.value);
            currentQuestions = selectedChapters.flatMap(chapter => quizData[chapter]).sort(() => Math.random() - 0.5);
            currentQuestionIndex = 0;
            userAnswers = [];
            seconds = 0;
            showScreen('quizScreen');
            showQuestion();
            startTimer();
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                seconds++;
                const mins = String(Math.floor(seconds / 60)).padStart(2, '0');
                const secs = String(seconds % 60).padStart(2, '0');
                timerEl.textContent = `${mins}:${secs}`;
            }, 1000);
        }

        function showQuestion() {
            nextBtn.style.display = 'none';
            optionsContainer.innerHTML = '';
            
            const progress = ((currentQuestionIndex) / currentQuestions.length) * 100;
            progressBar.style.width = `${progress}%`;

            const question = currentQuestions[currentQuestionIndex];
            questionCounter.textContent = `سوال ${currentQuestionIndex + 1} از ${currentQuestions.length}`;
            questionText.textContent = question.q;
            
            question.o.forEach((option, index) => {
                const button = document.createElement('button');
                button.textContent = option;
                button.classList.add('w-full', 'text-right', 'p-4', 'rounded-lg', 'text-lg', 'btn', 'btn-option');
                button.onclick = () => selectAnswer(index, button);
                optionsContainer.appendChild(button);
            });
        }

        function selectAnswer(selectedIndex, selectedButton) {
            userAnswers[currentQuestionIndex] = selectedIndex;
            optionsContainer.querySelectorAll('button').forEach(button => {
                button.disabled = true;
                button.classList.remove('selected');
            });
            selectedButton.classList.add('selected');
            nextBtn.style.display = 'block';
        }

        function handleNextQuestion() {
            currentQuestionIndex++;
            progressBar.style.width = `${(currentQuestionIndex / currentQuestions.length) * 100}%`;
            if (currentQuestionIndex < currentQuestions.length) {
                showQuestion();
            } else {
                progressBar.style.width = `100%`;
                showResults();
            }
        }

        function showResults() {
            clearInterval(timerInterval);
            showScreen('resultScreen');

            resultName.textContent = userNameInput.value.trim() || 'گمنام';
            resultTime.textContent = timerEl.textContent;
            
            const finalScore = userAnswers.reduce((score, answer, index) => {
                return answer === currentQuestions[index].a ? score + 1 : score;
            }, 0);

            animateScore(finalScore, currentQuestions.length);
            renderReview();
            sendTelegramReport(finalScore);
        }
        
        function animateScore(finalScore, total) {
            let displayedScore = 0;
            if (finalScore === 0) {
                resultScoreEl.textContent = `0 / ${total}`;
                return;
            }
            const scoreAnimation = setInterval(() => {
                if (displayedScore >= finalScore) {
                    clearInterval(scoreAnimation);
                    resultScoreEl.textContent = `${finalScore} / ${total}`;
                } else {
                    displayedScore++;
                    resultScoreEl.textContent = `${displayedScore} / ${total}`;
                }
            }, 50);
        }

        function renderReview() {
            answerReview.innerHTML = '';
            currentQuestions.forEach((q, index) => {
                const userAnswerIndex = userAnswers[index];
                const isCorrect = userAnswerIndex === q.a;
                const reviewItem = document.createElement('div');
                reviewItem.classList.add('p-4', 'bg-slate-800/50', 'rounded-lg', 'review-item');
                reviewItem.dataset.isCorrect = isCorrect;

                let optionsHtml = q.o.map((opt, optIndex) => `
                    <li class="mt-1 p-2 rounded-md text-slate-300 ${optIndex === q.a ? 'correct-answer-bg' : ''} ${optIndex === userAnswerIndex && !isCorrect ? 'incorrect-answer-bg' : ''}">
                        ${opt}
                    </li>`).join('');

                reviewItem.innerHTML = `
                    <div class="font-bold text-lg mb-3 text-slate-200">
                        <span class="text-slate-400">سوال ${index + 1}:</span> ${q.q}
                    </div>
                    <div>
                        <span class="font-semibold text-slate-300">آپشنز:</span>
                        <ul class="list-none pr-4 mt-1">${optionsHtml}</ul>
                    </div>
                    <div class="mt-4 pt-3 border-t border-slate-700">
                        <p><span class="font-semibold text-slate-300">آپ کا جواب:</span>
                           <span class="font-bold ${isCorrect ? 'text-green-400' : 'text-red-400'}">
                                ${userAnswerIndex !== undefined ? q.o[userAnswerIndex] : 'جواب نہیں دیا'}
                           </span>
                        </p>
                        ${!isCorrect ? 
                           `<p><span class="font-semibold text-slate-300">صحیح جواب:</span>
                           <span class="font-bold text-green-400">${q.o[q.a]}</span></p>` : ''}
                    </div>
                `;
                answerReview.appendChild(reviewItem);
            });
            
            // Auto-scroll to first incorrect answer
            const firstIncorrect = answerReview.querySelector('.review-item[data-is-correct="false"]');
            if (firstIncorrect) {
                firstIncorrect.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }

        function sanitizeForMarkdownV2(text) {
            if (typeof text !== 'string') return '';
            const charsToEscape = ['_', '*', '[', ']', '(', ')', '~', '`', '>', '#', '+', '-', '=', '|', '{', '}', '.', '!'];
            return text.replace(new RegExp(`[\\${charsToEscape.join('\\')}]`, 'g'), '\\$&');
        }

        async function sendTelegramReport(score) {
            telegramStatus.innerHTML = `<div class="spinner"></div><span>ٹیلیگرام پر نتائج بھیجے جا رہے ہیں...</span>`;
            const s = (text) => sanitizeForMarkdownV2(String(text));
            const userName = userNameInput.value.trim() || 'گمنام';
            const separator = '\\-\\-\\-\\-\\-\\-\\-\\-\\-\\-\\-\\-\\-\\-\\-\\-\\-\\-\\-\\-\\-\\-\\-\\-\\-\\-\\-\\-\\-\\-\\-';
            
            let header = `*✨ اردو کوئز رپورٹ ✨*\n\n` +
                         `*نام:* \`${s(userName)}\`\n` +
                         `*اسکور:* \`${s(`${score} / ${currentQuestions.length}`)}\`\n` +
                         `*وقت:* \`${s(timerEl.textContent)}\`\n` +
                         `${separator}\n\n`;

            let reportChunks = [];
            let currentChunk = header;

            for (let i = 0; i < currentQuestions.length; i++) {
                const q = currentQuestions[i];
                const userAnswer = userAnswers[i] !== undefined ? q.o[userAnswers[i]] : 'جواب نہیں دیا';
                const isCorrect = userAnswers[i] === q.a;

                let questionReport = `*سوال ${s(i + 1)}:* ${s(q.q)}\n` +
                                     `*آپ کا جواب:* ${s(userAnswer)} ${isCorrect ? '✅' : '❌'}\n`;
                if (!isCorrect) {
                    questionReport += `*صحیح جواب:* ${s(q.o[q.a])}\n`;
                }
                questionReport += `${separator}\n\n`;

                if ((currentChunk + questionReport).length > 4096) {
                    reportChunks.push(currentChunk);
                    currentChunk = questionReport;
                } else {
                    currentChunk += questionReport;
                }
            }
            reportChunks.push(currentChunk);

            try {
                for (const chunk of reportChunks) {
                    if (chunk.trim() === '' || chunk.trim() === header.trim()) continue;
                    
                    const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ chat_id: CHAT_ID, text: chunk, parse_mode: 'MarkdownV2' }),
                    });
                    
                    const data = await response.json();
                    if (!response.ok) {
                        console.error('Telegram API Response:', data);
                        throw new Error(data.description || 'API request failed');
                    }
                }
                telegramStatus.innerHTML = `✅ نتائج کامیابی کے ساتھ ٹیلیگرام پر بھیج دیے گئے۔`;
                telegramStatus.classList.replace('text-yellow-400', 'text-green-400');
            } catch (error) {
                console.error('Telegram API Error:', error);
                telegramStatus.textContent = `❌ ٹیلیگرام پر بھیجنے میں خرابی: ${error.message}`;
                telegramStatus.classList.replace('text-yellow-400', 'text-red-400');
            }
        }

        // --- EVENT LISTENERS ---
        function setupEventListeners() {
            continueBtn.addEventListener('click', () => showScreen('nameScreen'));
            startQuizBtn.addEventListener('click', startQuiz);
            nextBtn.addEventListener('click', handleNextQuestion);
            
            restartBtn.addEventListener('click', () => restartModal.classList.add('visible'));
            cancelRestartBtn.addEventListener('click', () => restartModal.classList.remove('visible'));
            confirmRestartBtn.addEventListener('click', () => location.reload());

            selectAllCheckbox.addEventListener('change', () => {
                document.querySelectorAll('.chapter-checkbox').forEach(c => c.checked = selectAllCheckbox.checked);
                continueBtn.disabled = !selectAllCheckbox.checked;
            });
            
            chapterList.addEventListener('change', (e) => {
                if (e.target.classList.contains('chapter-checkbox')) {
                    const checkboxes = document.querySelectorAll('.chapter-checkbox');
                    continueBtn.disabled = ![...checkboxes].some(c => c.checked);
                    selectAllCheckbox.checked = [...checkboxes].every(c => c.checked);
                }
            });
        }

        // --- INITIALIZATION ---
        window.onload = () => {
            populateChapters();
            setupEventListeners();
            showScreen('chapterScreen');
        };
    </script>
</body>
</html>
